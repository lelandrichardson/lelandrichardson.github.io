<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/app.1b56f0f3ea8e10aaf677.css">@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:200;src:local("Oswald Extra Light "),local("Oswald-Extra Light"),url(/static/oswald-latin-200-7de4e8c7241042bac22064babb6649a6.woff2) format("woff2"),url(/static/oswald-latin-200-74b035507786c9fa80f85f11d92a502c.woff) format("woff")}@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:300;src:local("Oswald Light "),local("Oswald-Light"),url(/static/oswald-latin-300-dc15f3b07cb711e818ecb48de992992c.woff2) format("woff2"),url(/static/oswald-latin-300-d2c191b2e46f060bf90b34e6b3f73d83.woff) format("woff")}@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:400;src:local("Oswald Regular "),local("Oswald-Regular"),url(/static/oswald-latin-400-f15aa285863274b4f6ed578caa76565e.woff2) format("woff2"),url(/static/oswald-latin-400-ca70f49a133f08485bd05d5cb28ef8b7.woff) format("woff")}@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:500;src:local("Oswald Medium "),local("Oswald-Medium"),url(/static/oswald-latin-500-541a863959122f29c9961095cdcbb5c2.woff2) format("woff2"),url(/static/oswald-latin-500-deebf8fc5d31111f3144d0c6373143cc.woff) format("woff")}@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:600;src:local("Oswald SemiBold "),local("Oswald-SemiBold"),url(/static/oswald-latin-600-b81a3735849bb304ae25ae10c748d5ab.woff2) format("woff2"),url(/static/oswald-latin-600-452513e2767e99884b1c084dad03126b.woff) format("woff")}@font-face{font-family:Oswald;font-style:normal;font-display:swap;font-weight:700;src:local("Oswald Bold "),local("Oswald-Bold"),url(/static/oswald-latin-700-3e941c0d10bcb614ac1442884055d2bf.woff2) format("woff2"),url(/static/oswald-latin-700-7eb521f12cd966b030825fa662677353.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 2.0.76"/><style data-styled="kvIrRe jXNdrO hnIOCF fkIoOY kxKAiC yAlUC cSXGyp hDpBCN dBkJBP jSWxAb eYyouk fnCCfl jqdpqf ldSKzY hVzkRp iDGdFF fjerEM" data-styled-version="4.1.3">
/* sc-component-id: styled-link__StyledLink-mjb46b-0 */
.jXNdrO{-webkit-text-decoration:none;text-decoration:none;color:rgba(0,0,0,0.8);}
/* sc-component-id: header__Container-di30r3-0 */
.kvIrRe{box-shadow:0 4px 12px 0 rgba(0,0,0,0.05);height:6rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
/* sc-component-id: header__Title-di30r3-1 */
.hnIOCF{font-size:1.6rem;font-weight:800;-webkit-letter-spacing:0.1rem;-moz-letter-spacing:0.1rem;-ms-letter-spacing:0.1rem;letter-spacing:0.1rem;text-transform:uppercase;margin:0 auto 0 24px;} @media (max-width:36em){.hnIOCF{text-align:center;}}
/* sc-component-id: header__Icon-di30r3-2 */
.fkIoOY{height:2.5rem;width:2.5rem;padding:1.5rem 1rem;margin-right:24px;}
/* sc-component-id: sc-global-332799677 */
@font-face{font-family:system;font-style:normal;font-weight:300;src:local('.SFNSText-Light'),local('.HelveticaNeueDeskInterface-Light'), local('.LucidaGrandeUI'),local('Ubuntu Light'),local('Segoe UI Light'), local('Roboto-Light'),local('DroidSans'),local('Tahoma');} :root{font-size:10px;} body{font-family:Verdana;margin:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);min-height:100vh;position:relative;font-size:1.9rem;} h1,h2,h3,h4,h5,h6{font-family:'Oswald',sans-serif;} h2{font-size:2.5rem;} h3{font-size:2.4rem;} h4{font-size:1.9rem;} code{font-family:Menlo,Monaco,"Courier New",Courier,monospace;word-break:break-word;} code[class*="language-"],pre[class*="language-"]{line-height:1.3;} pre code{word-break:normal;font-size:1.4rem;} :not(pre) > code[class*="language-"]{background-color:#eaeaea;padding:.1em 0.5em;border-radius:.2em;color:#8a4519;font-size:smaller;line-height:1.6;} .table{width:100%;border:1px solid #222;border-spacing:0;border-collapse:collapse;font-size:1.4rem;} .table td,.table th{padding:4px;vertical-align:top;border-top:1px solid #222;border:1px solid #222;} .table thead th{vertical-align:bottom;border-bottom:2px solid #222;} .remark-code-title{margin-bottom:-8px;padding:0.5em 1em;font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;background-color:#464646;color:white;z-index:0;border-top-left-radius:0.3em;border-top-right-radius:0.3em;} twitter-widget{margin:10px auto;}
/* sc-component-id: layout__Footer-sc-14pgzi3-0 */
.fjerEM{display:block;height:6rem;}
/* sc-component-id: layout__Content-sc-14pgzi3-1 */
.kxKAiC{width:60%;max-width:728px;margin:0 auto;} @media (max-width:48em){.kxKAiC{width:80%;}}
/* sc-component-id: post-styles__Container-axwg2q-0 */
.yAlUC{margin-top:8rem;} @media (max-width:36em){.yAlUC{margin-top:4rem;}} .yAlUC p{line-height:1.5;} .yAlUC blockquote{margin-left:0.25rem;font-size:1.6rem;color:inherit;font-style:italic;border-left:0.2rem solid rgb(0,0,0);padding-left:1rem;margin:1rem 0;} .yAlUC pre{margin-bottom:2rem;} .yAlUC h3{line-height:1.13;} .yAlUC h2,.yAlUC h3,.yAlUC h4,.yAlUC h5,.yAlUC h6{margin:2rem 0 2rem;} .yAlUC hr{border:0;border-top:0.1rem solid #ccc;display:block;height:1rem;padding:0;}
/* sc-component-id: post-styles__Header-axwg2q-1 */
@media (max-width:48em){.cSXGyp{text-align:center;}}
/* sc-component-id: post-styles__Title-axwg2q-2 */
.hDpBCN{margin-bottom:1rem;font-size:3rem;}
/* sc-component-id: post-styles__LinkList-axwg2q-3 */
.iDGdFF{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding:0px;}
/* sc-component-id: bio__Container-hbzvw6-0 */
.eYyouk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin:5rem 0;} @media (max-width:48em){.eYyouk{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;text-align:center;}}
/* sc-component-id: bio__TextContainer-hbzvw6-1 */
@media (max-width:36em){.fnCCfl{-webkit-order:2;-ms-flex-order:2;order:2;}}
/* sc-component-id: bio__ImageContainer-hbzvw6-2 */
@media (max-width:36em){.hVzkRp{-webkit-order:1;-ms-flex-order:1;order:1;}}
/* sc-component-id: bio__Name-hbzvw6-3 */
.jqdpqf{font-size:2.4rem;-webkit-letter-spacing:0.1rem;-moz-letter-spacing:0.1rem;-ms-letter-spacing:0.1rem;letter-spacing:0.1rem;font-weight:800;margin-bottom:1rem;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-family:"system";}
/* sc-component-id: bio__TagLine-hbzvw6-4 */
.ldSKzY{font-weight:normal;font-size:1.6rem;margin:0;margin-right:3rem;display:block;}
/* sc-component-id: sc-bdVaJa */
.dBkJBP{color:rgba(0,0,0,0.8);}
/* sc-component-id: sc-bwzfXH */
.jSWxAb{margin:5rem 0;}</style><title data-react-helmet="true">Lukemapper: A Super Fast ORM for Lucene.net | Intelligible Babble</title><meta data-react-helmet="true" name="description" content="Lucene is a document storage search engine library that utilizes inverted indexes and has great capabilities. It has been very popular and…"/><meta data-react-helmet="true" property="og:title" content="Lukemapper: A Super Fast ORM for Lucene.net"/><meta data-react-helmet="true" property="og:description" content="Lucene is a document storage search engine library that utilizes inverted indexes and has great capabilities. It has been very popular and…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Leland Richardson"/><meta data-react-helmet="true" name="twitter:title" content="Lukemapper: A Super Fast ORM for Lucene.net"/><meta data-react-helmet="true" name="twitter:description" content="Lucene is a document storage search engine library that utilizes inverted indexes and has great capabilities. It has been very popular and…"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link as="script" rel="preload" href="/0-a21edeffd72a969fe347.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-1e472f78b066349f98a7.js"/><link as="script" rel="preload" href="/1-633766256462afcfa2e5.js"/><link as="script" rel="preload" href="/app-873de7bb737df1e4d255.js"/><link as="script" rel="preload" href="/webpack-runtime-3b803a0407233ac71e73.js"/><link as="fetch" rel="preload" href="/static/d/685/path---lukemapper-a-super-fast-orm-for-lucenenet-a-2-a-b47-D36HgGwnopXvlA3K2uZ6u5PGKE.json" crossOrigin="use-credentials"/></head><body><noscript>Sorry! This site requires JavaScript to be enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><nav class="header__Container-di30r3-0 kvIrRe"><a class="styled-link__StyledLink-mjb46b-0 jXNdrO" href="/"><h1 class="header__Title-di30r3-1 hnIOCF">Intelligible Babble</h1></a><a style="margin-left:auto" href="https://twitter.com/intelligibabble" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJDYXBhXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgNjEyIDYxMiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNjEyIDYxMjsiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPGc+DQoJPGc+DQoJCTxwYXRoIHN0eWxlPSJmaWxsOiMwMTAwMDI7IiBkPSJNNjEyLDExNi4yNThjLTIyLjUyNSw5Ljk4MS00Ni42OTQsMTYuNzUtNzIuMDg4LDE5Ljc3MmMyNS45MjktMTUuNTI3LDQ1Ljc3Ny00MC4xNTUsNTUuMTg0LTY5LjQxMQ0KCQkJYy0yNC4zMjIsMTQuMzc5LTUxLjE2OSwyNC44Mi03OS43NzUsMzAuNDhjLTIyLjkwNy0yNC40MzctNTUuNDktMzkuNjU4LTkxLjYzLTM5LjY1OGMtNjkuMzM0LDAtMTI1LjU1MSw1Ni4yMTctMTI1LjU1MSwxMjUuNTEzDQoJCQljMCw5LjgyOCwxLjEwOSwxOS40MjcsMy4yNTEsMjguNjA2QzE5Ny4wNjUsMjA2LjMyLDEwNC41NTYsMTU2LjMzNyw0Mi42NDEsODAuMzg2Yy0xMC44MjMsMTguNTEtMTYuOTgsNDAuMDc4LTE2Ljk4LDYzLjEwMQ0KCQkJYzAsNDMuNTU5LDIyLjE4MSw4MS45OTMsNTUuODM1LDEwNC40NzljLTIwLjU3NS0wLjY4OC0zOS45MjYtNi4zNDgtNTYuODY3LTE1Ljc1NnYxLjU2OGMwLDYwLjgwNiw0My4yOTEsMTExLjU1NCwxMDAuNjkzLDEyMy4xMDQNCgkJCWMtMTAuNTE3LDIuODMtMjEuNjA3LDQuMzk4LTMzLjA4LDQuMzk4Yy04LjEwNywwLTE1Ljk0Ny0wLjgwMy0yMy42MzQtMi4zMzNjMTUuOTg1LDQ5LjkwNyw2Mi4zMzYsODYuMTk5LDExNy4yNTMsODcuMTk0DQoJCQljLTQyLjk0NywzMy42NTQtOTcuMDk5LDUzLjY1NS0xNTUuOTE2LDUzLjY1NWMtMTAuMTM0LDAtMjAuMTE2LTAuNjEyLTI5Ljk0NC0xLjcyMWM1NS41NjcsMzUuNjgxLDEyMS41MzYsNTYuNDg1LDE5Mi40MzgsNTYuNDg1DQoJCQljMjMwLjk0OCwwLDM1Ny4xODgtMTkxLjI5MSwzNTcuMTg4LTM1Ny4xODhsLTAuNDIxLTE2LjI1M0M1NzMuODcyLDE2My41MjYsNTk1LjIxMSwxNDEuNDIyLDYxMiwxMTYuMjU4eiIvPg0KCTwvZz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjwvc3ZnPg0K" alt="twitter" class="header__Icon-di30r3-2 fkIoOY"/></a><a href="https://github.com/lelandrichardson" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+R2l0SHViIGljb248L3RpdGxlPjxwYXRoIGQ9Ik0xMiAuMjk3Yy02LjYzIDAtMTIgNS4zNzMtMTIgMTIgMCA1LjMwMyAzLjQzOCA5LjggOC4yMDUgMTEuMzg1LjYuMTEzLjgyLS4yNTguODItLjU3NyAwLS4yODUtLjAxLTEuMDQtLjAxNS0yLjA0LTMuMzM4LjcyNC00LjA0Mi0xLjYxLTQuMDQyLTEuNjFDNC40MjIgMTguMDcgMy42MzMgMTcuNyAzLjYzMyAxNy43Yy0xLjA4Ny0uNzQ0LjA4NC0uNzI5LjA4NC0uNzI5IDEuMjA1LjA4NCAxLjgzOCAxLjIzNiAxLjgzOCAxLjIzNiAxLjA3IDEuODM1IDIuODA5IDEuMzA1IDMuNDk1Ljk5OC4xMDgtLjc3Ni40MTctMS4zMDUuNzYtMS42MDUtMi42NjUtLjMtNS40NjYtMS4zMzItNS40NjYtNS45MyAwLTEuMzEuNDY1LTIuMzggMS4yMzUtMy4yMi0uMTM1LS4zMDMtLjU0LTEuNTIzLjEwNS0zLjE3NiAwIDAgMS4wMDUtLjMyMiAzLjMgMS4yMy45Ni0uMjY3IDEuOTgtLjM5OSAzLS40MDUgMS4wMi4wMDYgMi4wNC4xMzggMyAuNDA1IDIuMjgtMS41NTIgMy4yODUtMS4yMyAzLjI4NS0xLjIzLjY0NSAxLjY1My4yNCAyLjg3My4xMiAzLjE3Ni43NjUuODQgMS4yMyAxLjkxIDEuMjMgMy4yMiAwIDQuNjEtMi44MDUgNS42MjUtNS40NzUgNS45Mi40Mi4zNi44MSAxLjA5Ni44MSAyLjIyIDAgMS42MDYtLjAxNSAyLjg5Ni0uMDE1IDMuMjg2IDAgLjMxNS4yMS42OS44MjUuNTdDMjAuNTY1IDIyLjA5MiAyNCAxNy41OTIgMjQgMTIuMjk3YzAtNi42MjctNS4zNzMtMTItMTItMTIiLz48L3N2Zz4=" alt="github" class="header__Icon-di30r3-2 fkIoOY"/></a></nav><div class="layout__Content-sc-14pgzi3-1 kxKAiC"><article class="post-styles__Container-axwg2q-0 yAlUC"><header class="post-styles__Header-axwg2q-1 cSXGyp"><h1 class="post-styles__Title-axwg2q-2 hDpBCN">Lukemapper: A Super Fast ORM for Lucene.net</h1><sub class="sc-bdVaJa dBkJBP"><span>Posted on <!-- -->February 11, 2013</span><span>  -  </span><span>10 min read</span></sub></header><div class="sc-bwzfXH jSWxAb"><p>Lucene is a document storage search engine library that utilizes inverted indexes and has great capabilities. It has been very popular and has been ported to almost every language, including .Net.</p>
<p>We use Lucene.Net for search here at Tech.Pro. Lucene has incredibly useful features, but it is built to work solely with strings, which can be a strong disadvantage if one is trying to store data of other types in a document. In addition, translating documents to strongly typed objects can be an annoying and redundant task.</p>
<p>We also use Dapper.Net here at Tech.Pro, and we love it’s simple API and extremely satisfactory performance.</p>
<h2>Purpose</h2>
<p>The concept I am trying to achieve is something similar in spirit to <a href="http://code.google.com/p/dapper-dot-net/">Dapper</a>, except is meant to deal with mapping Lucene Documents to generic Objects, rather than Rows from a database.</p>
<p>Although Lucene is schema-less, in practice there is often an implicit schema in a Document which corresponds to a class or object in your code-base. Although you can easily use ORMs like Dapper or EntityFramework to map data from an RDBMS to CLR objects, doing so in Lucene is cumbersome and error-prone. Enter LukeMapper:</p>
<p>The desired API is something like the following:</p>
<p>Given some generic class in .Net like as follows:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">class</span> <span class="token class-name">PocoClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> PropId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> PropName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>Read Operations</h2>
<p>If I wanted to run a query against an <code class="language-text">IndexSearcher</code> in Lucene, and return the corresponding documents
mapped to a List<PocoClass>, I could do the following:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name">IndexSearcher</span> searcher<span class="token punctuation">;</span>
<span class="token class-name">Query</span> qry<span class="token punctuation">;</span>
<span class="token keyword">int</span> numberToReturn <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

List<span class="token operator">&lt;</span>PocoClass<span class="token operator">></span> results <span class="token operator">=</span> searcher<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token punctuation">&lt;</span><span class="token class-name">PocoClass</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>qry<span class="token punctuation">,</span> numberToReturn<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Thus, the <code class="language-text">.Query&lt;T&gt;(Query,int)</code> method is implemented as an extension method to an <code class="language-text">IndexSearcher</code>, similar to
how Dapper’s <code class="language-text">.Query&lt;T&gt;</code> method is implemented as an extension method to an <code class="language-text">IDBConnection</code> object.</p>
<h2>Write Operations</h2>
<p>Similarly, for Write operations, I would do the following:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name">IndexWriter</span> writer<span class="token punctuation">;</span>
IEnumerable<span class="token operator">&lt;</span>PocoClass<span class="token operator">></span> objects<span class="token punctuation">;</span>

<span class="token comment">// insert objects into index</span>
writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>objects<span class="token punctuation">)</span></code></pre></div>
<p>And similarly, an update operation:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name">IndexWriter</span> writer<span class="token punctuation">;</span>
IEnumerable<span class="token operator">&lt;</span>PocoClass<span class="token operator">></span> objects<span class="token punctuation">;</span>
<span class="token comment">//method to find the corresponding document to update</span>
Func<span class="token operator">&lt;</span>PocoClass<span class="token punctuation">,</span> Query<span class="token operator">></span> identifyingQuery <span class="token operator">=</span> o <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">TermQuery</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Term</span><span class="token punctuation">(</span><span class="token string">"Id"</span><span class="token punctuation">,</span>o<span class="token punctuation">.</span>Id<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// update objects in index</span>
writer<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>objects<span class="token punctuation">,</span> identifyingQuery<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Similar to Dapper and <a href="https://github.com/sapiens/SqlFu">other Micro-ORMs out there</a>, the implementation of the <strong>mapping will be done by generating a Deserializer/Serializer method via IL-Generation and caching it</strong>.</p>
<p>For the <code class="language-text">.Query()</code> operation, the desired IL method generated should be semantically similar to the IL generated from the following method:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PocoClass</span> <span class="token function">ExampleDeserializerMethod</span><span class="token punctuation">(</span><span class="token class-name">Document</span> document<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> poco <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PocoClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    poco<span class="token punctuation">.</span>Id <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"Id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    poco<span class="token punctuation">.</span>Name <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"Name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    poco<span class="token punctuation">.</span>PropId <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"PropId"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    poco<span class="token punctuation">.</span>PropName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"PropName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> poco<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Similarly, for the <code class="language-text">.Write()</code> and <code class="language-text">Update()</code> methods, the Serializer methods will be semantically similar to the IL generated from the following method:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Document</span> <span class="token function">ExampleSerializerMethod</span><span class="token punctuation">(</span><span class="token class-name">PocoClass</span> obj<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    doc<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Field</span><span class="token punctuation">(</span><span class="token string">"Id"</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>Id<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Field<span class="token punctuation">.</span>Store<span class="token punctuation">.</span>YES<span class="token punctuation">,</span> Field<span class="token punctuation">.</span>Index<span class="token punctuation">.</span>NOT_ANALYZED_NO_NORMS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    doc<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Field</span><span class="token punctuation">(</span><span class="token string">"Name"</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> Field<span class="token punctuation">.</span>Store<span class="token punctuation">.</span>YES<span class="token punctuation">,</span> Field<span class="token punctuation">.</span>Index<span class="token punctuation">.</span>NOT_ANALYZED_NO_NORMS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    doc<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Field</span><span class="token punctuation">(</span><span class="token string">"PropId"</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>PropId<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Field<span class="token punctuation">.</span>Store<span class="token punctuation">.</span>YES<span class="token punctuation">,</span> Field<span class="token punctuation">.</span>Index<span class="token punctuation">.</span>NOT_ANALYZED_NO_NORMS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    doc<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Field</span><span class="token punctuation">(</span><span class="token string">"PropName"</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>PropName<span class="token punctuation">,</span> Field<span class="token punctuation">.</span>Store<span class="token punctuation">.</span>YES<span class="token punctuation">,</span> Field<span class="token punctuation">.</span>Index<span class="token punctuation">.</span>NOT_ANALYZED_NO_NORMS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> doc<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Although, some error handling may need to be inserted, among other things to make the method a bit more robust.</p>
<h2>Enhancing / Customizing with Attributes</h2>
<p>Although basic functionality works essentially out of the box, with no attributes needed, further flexibility is garnered by the use of various Attributes.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token class-name">LukeMapper</span><span class="token punctuation">(</span>IgnoreByDefault <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleClass</span>
<span class="token punctuation">{</span>
    <span class="token comment">// doesn't get indexed/stored</span>
    <span class="token punctuation">[</span><span class="token class-name">Luke</span><span class="token punctuation">(</span>Store <span class="token operator">=</span> Store<span class="token punctuation">.</span>YES<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// doesn't get stored, but is indexed in "searchtext" field</span>
    <span class="token punctuation">[</span><span class="token class-name">Luke</span><span class="token punctuation">(</span>Store <span class="token operator">=</span> Store<span class="token punctuation">.</span>NO<span class="token punctuation">,</span> Index <span class="token operator">=</span> Index<span class="token punctuation">.</span>ANALYZED<span class="token punctuation">,</span> FieldName <span class="token operator">=</span> <span class="token string">"searchtext"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Title <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// doesn't get stored, but is indexed in "searchtext" field</span>
    <span class="token punctuation">[</span><span class="token class-name">Luke</span><span class="token punctuation">(</span>Store <span class="token operator">=</span> Store<span class="token punctuation">.</span>NO<span class="token punctuation">,</span> Index <span class="token operator">=</span> Index<span class="token punctuation">.</span>ANALYZED<span class="token punctuation">,</span> FieldName <span class="token operator">=</span> <span class="token string">"searchtext"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Body <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// doesn't get indexed/stored</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> IgnoredProperty <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token class-name">LukeMapper</span><span class="token punctuation">(</span>DefaultIndex <span class="token operator">=</span> Index<span class="token punctuation">.</span>ANALYZED<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleClass</span>
<span class="token punctuation">{</span>
    <span class="token comment">// doesn't get indexed/stored</span>
    <span class="token punctuation">[</span><span class="token class-name">Luke</span><span class="token punctuation">(</span>Index <span class="token operator">=</span> Index<span class="token punctuation">.</span>NOT_ANALYZED_NO_NORMS<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// get's analyzed, AND stored</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Title <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// get's analyzed, AND stored</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Body <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleClass</span>
<span class="token punctuation">{</span>
    <span class="token comment">// everything get's indexed and stored by default</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Title <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Body <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">//opt-in ignored per property/field</span>
    <span class="token punctuation">[</span><span class="token class-name">Luke</span><span class="token punctuation">(</span>Ignore<span class="token operator">=</span><span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Ignored <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleClass</span>
<span class="token punctuation">{</span>
    <span class="token comment">// everything get's indexed and stored by default</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Title <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Body <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">//opt-in ignored per property/field</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Ignored <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>Custom Serialization/Deserialization</h2>
<p>You can override the serialization of certain properties, even more complex ones which are not supported, if it is needed for your application.</p>
<p>For instance, a common example might be that I have a list or array of something that I would like to serialize/deserialize into the document.</p>
<p>In this case, you can simply specify a static method to use for the serialization (and deserialization) using the <code class="language-text">LukeSerializerAttribute</code> and <code class="language-text">LukeDeserializerAttribute</code>.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCustomSerializerClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">//this list would typically be ignored</span>
    <span class="token keyword">public</span> List<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">></span> CustomList <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// if you specify a serializer, it will get serialized</span>
    <span class="token punctuation">[</span><span class="token class-name">LukeSerializer</span><span class="token punctuation">(</span><span class="token string">"CustomList"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">string</span> <span class="token function">CustomListToString</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">></span> list<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// and similarly, deserialized</span>
    <span class="token punctuation">[</span><span class="token class-name">LukeDeserializer</span><span class="token punctuation">(</span><span class="token string">"CustomList"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> List<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">></span> <span class="token function">StringToCustomList</span><span class="token punctuation">(</span><span class="token keyword">string</span> serialized<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> serialized<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCustomSerializerClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// maybe you just want to index the list for search, but don't need it on .Query()</span>
    <span class="token punctuation">[</span><span class="token class-name">Luke</span><span class="token punctuation">(</span>Store <span class="token operator">=</span> Store<span class="token punctuation">.</span>NO<span class="token punctuation">,</span>Index <span class="token operator">=</span> Index<span class="token punctuation">.</span>ANALYZED<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> List<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">></span> CustomList <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// in this case, only a serializer is needed</span>
    <span class="token punctuation">[</span><span class="token class-name">LukeSerializer</span><span class="token punctuation">(</span><span class="token string">"CustomList"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">string</span> <span class="token function">CustomListToString</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">></span> list<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>As of now, the cacheing is done via a hashcode which should be unique to the declared fields in the <code class="language-text">IndexSearcher</code>’s index,
and the object type which it is being mapped to.</p>
<h2>Data Types supported:</h2>
<ul>
<li>
<p>Textual:</p>
<ul>
<li><code class="language-text">string</code></li>
<li><code class="language-text">char</code></li>
</ul>
</li>
<li>
<p>Numeric:</p>
<ul>
<li><code class="language-text">int</code></li>
<li><code class="language-text">int?</code></li>
<li><code class="language-text">long</code></li>
<li><code class="language-text">long?</code></li>
</ul>
</li>
<li>
<p>Other:</p>
<ul>
<li><code class="language-text">bool</code></li>
<li><code class="language-text">bool?</code></li>
<li><code class="language-text">DateTime</code></li>
<li><code class="language-text">DateTime?</code></li>
</ul>
</li>
<li>
<p>In Progress (Not Yet Supported):</p>
<ul>
<li><code class="language-text">char?</code></li>
<li><code class="language-text">byte</code></li>
<li><code class="language-text">byte?</code></li>
</ul>
</li>
</ul>
<h2>Performance</h2>
<p>With an example class:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Id<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">string</span> PropString <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The test was to instantiate 500 instances of <code class="language-text">TestClass</code>, and compared inserting the</p>
<table class="table table-bordered">
<tr>
    <th>Operation</th>
    <th>LukeMapper</th>
    <th>Lucene.Net (native)</th>
</tr>
<tr>
    <td>Insert 500 Documents (With no Serializer Cached)</td>
    <td>89ms</td>
    <td>19ms</td>
</tr>
<tr>
    <td>Insert 500 Documents (Subsequent Calls)</td>
    <td>3.31ms</td>
    <td>4.52ms</td>
</tr>
<tr>
    <td>Query 500 Documents (With no Deserializer Cached)</td>
    <td>49ms</td>
    <td>1ms</td>
</tr>
<tr>
    <td>Query 500 Documents (Subsequent Calls)</td>
    <td>1.26ms</td>
    <td>1.05ms</td>
</tr>
</table>
<p>This is a simple class, with only a string and an int, so I ran a second test with 2 more properties:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestClass1</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> PropString <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">DateTime</span> DateTime <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span><span class="token operator">?</span> NullId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Which had the following similar performance:</p>
<table class="table table-bordered">
<tr>
    <th>Operation</th>
    <th>LukeMapper</th>
    <th>Lucene.Net (native)</th>
</tr>
<tr>
    <td>Insert 500 Documents (With no Serializer Cached)</td>
    <td>103ms</td>
    <td>23ms</td>
</tr>
<tr>
    <td>Insert 500 Documents (Subsequent Calls)</td>
    <td>5.84ms</td>
    <td>6.05ms</td>
</tr>
<tr>
    <td>Query 500 Documents (With no Deserializer Cached)</td>
    <td>42ms</td>
    <td>2ms</td>
</tr>
<tr>
    <td>Query 500 Documents (Subsequent Calls)</td>
    <td>1.84ms</td>
    <td>1.15ms</td>
</tr>
</table>
<p>What these benchmarks show is essentially what is to be expected. The first time <code class="language-text">.Write()</code> is called on a class, it takes O(10^2) ms to generate the deserializer/serializer method. Once it is cached, the write and read operations are of the same order as the native calls (which they should be, since we are generating essentially the same CIL as when we are hand-coding it). What is a bit mysterious to me is why LukeMapper seems to consistently be writing to the index faster. This may be an issue with the benchmark. You can find the actual code used to find these numbers <a href="https://github.com/lelandrichardson/LukeMapper/blob/master/LukeMapper.Benchmarks/Program.cs">here</a></p>
<p>If anyone would like me to compare it to anything else, let me know. As far as I know there aren’t really any other ORMs for lucene out there to compare against.</p>
<h2>Pseudo-Code: Under The Hood</h2>
<p>The code of LukeMapper is essentially a <a href="https://github.com/lelandrichardson/LukeMapper/blob/master/LukeMapper.cs">single file</a> which exposes several extension methods to <code class="language-text">IndexWriter</code> and <code class="language-text">IndexSearcher</code>.</p>
<p>The <code class="language-text">.Query()</code> method might look like this:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> IEnumerable<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token generic-method"><span class="token function">Query</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
    <span class="token keyword">this</span> <span class="token class-name">IndexSearcher</span> searcher<span class="token punctuation">,</span>
    <span class="token class-name">Query</span> query<span class="token punctuation">,</span>
    <span class="token keyword">int</span> n <span class="token comment">/*, Sort sort*/</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// run actual search</span>
    <span class="token class-name">TopDocs</span> td <span class="token operator">=</span> searcher<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// if no results, nothing to do</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>td<span class="token punctuation">.</span>TotalHits <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">yield</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//check to see if we have a deserializer</span>
    <span class="token keyword">var</span> deserializer <span class="token operator">=</span> Cache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">,</span>searcher<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>deserializer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// need to generate deserializer</span>
        deserializer <span class="token operator">=</span> <span class="token function">GenerateDeserializer</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">,</span>searcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//perform mapping</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword">var</span> document <span class="token keyword">in</span> td<span class="token punctuation">.</span>ScoreDocs<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>sd<span class="token operator">=</span><span class="token operator">></span>searcher<span class="token punctuation">.</span><span class="token function">Doc</span><span class="token punctuation">(</span>sd<span class="token punctuation">.</span>doc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">object</span> next<span class="token punctuation">;</span>
        next <span class="token operator">=</span> <span class="token function">deserializer</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>All of the magic is essentially in the <code class="language-text">GenerateDeserializer</code> method. This is where reflection is used to determine what IL to generate and cache as a method. In some seriously simplified pseudo-code:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token keyword">static</span> Func<span class="token operator">&lt;</span>Document<span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token operator">></span> <span class="token function">GenerateDeserializer</span><span class="token punctuation">(</span><span class="token class-name">Type</span> type<span class="token punctuation">,</span> <span class="token class-name">IndexSearcher</span> searcher<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> dm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicMethod</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> il <span class="token operator">=</span> dm<span class="token punctuation">.</span><span class="token function">GetILGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> properties <span class="token operator">=</span> <span class="token function">GetSettableProps</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> fields <span class="token operator">=</span> <span class="token function">GetSettableFields</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> attributes <span class="token operator">=</span> <span class="token function">GetLukeAttributes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> properties<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// figure out prop type, attributes, etc. and emit proper IL.</span>
        il<span class="token punctuation">.</span><span class="token function">Emit</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        il<span class="token punctuation">.</span><span class="token function">Emit</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        il<span class="token punctuation">.</span><span class="token function">Emit</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword">var</span> field <span class="token keyword">in</span> fields<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// figure out prop type, attributes, etc. and emit proper IL.</span>
        il<span class="token punctuation">.</span><span class="token function">Emit</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        il<span class="token punctuation">.</span><span class="token function">Emit</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        il<span class="token punctuation">.</span><span class="token function">Emit</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>Func<span class="token operator">&lt;</span>Document<span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token operator">></span><span class="token punctuation">)</span>dm<span class="token punctuation">.</span><span class="token function">CreateDelegate</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>Func<span class="token operator">&lt;</span>Document<span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The methods for generating serializer methods are very similar.</p>
<p>If you are interested in the code, you can see it all on <a href="https://github.com/lelandrichardson/LukeMapper">github</a></p>
<h3>Notes</h3>
<p>In many ways this is not as practical as Dapper and is more of a specific application; Lucene is only meant to handle textual data and is schema-less, so mapping to objects of non-textual type with a specific schema is more error prone. The reality, though, is that most Lucene indexes are implemented with a relatively uniform schema.</p>
<h3>Current Status</h3>
<p>I have started working on this project more and think it has promise and will likely use it in some projects of my own. If anyone is interested in helping out, I would certainly love the help. On the other hand, if anyone has any suggestions or feature requests, bring them on. Although this is not currently used in the Tech.Pro codebase, it will be soon.</p>
<p>Right now, I am focusing on the following:</p>
<ul>
<li>Improve the error handling / feedback currently</li>
<li>Build in some support for <code class="language-text">NumericField</code>s</li>
<li>Attribute to specify the “Identifier” of an object, and auto-generate the “identifyingQuery” needed for the <code class="language-text">Update()</code> method.</li>
<li>Attribute to utilize term vectors usefully</li>
<li>Build in some automatic support for handling lists in typical fashion (ie csv, json-encoding, etc)</li>
<li>get <code class="language-text">char</code>’s and <code class="language-text">byte</code>’s working (seriously, why are they so difficult?)</li>
<li>I would like to get the project hosted on NuGet. Need to look into this as I have never done it.</li>
</ul>
<p><strong>Link to <a href="https://github.com/lelandrichardson/LukeMapper">LukeMapper GitHub Repo</a></strong></p>
<p>Any and all comments/feedback appreciated!</p></div><a href="/">Back to Home</a><div class="bio__Container-hbzvw6-0 eYyouk"><div class="bio__TextContainer-hbzvw6-1 fnCCfl"><h3 class="bio__Name-hbzvw6-3 jqdpqf">Leland Richardson</h3><sub class="bio__TagLine-hbzvw6-4 ldSKzY">Personal blog of Leland Richardson.<br/>Software Engineer at Google working on Android. Previously Airbnb.</sub></div><div class="bio__ImageContainer-hbzvw6-2 hVzkRp"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:156px;height:156px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAFOUlEQVQ4y2WTC0xTVxjHL87Mx+KSmSzGmTmYmCkbSqaCMaioPJUpoIwiTGA8KhMqitAC7Xi0YJGW8ihU3lCRLspLLQJOB3NTYYrZpshDRnQSpoDMJ9Lee89/t5WamJ3k5Pvu+b7zu//vO+dQLMtSpkEIoTj/HWpmvHz50hNABTeHjdMG9t+JCUw+nhjlvk9xM+B27/AcUx7nzzIajFYWxhsYwzBWMwmbaZq+jplRXFiEsMAg+Hp5kmA/PyQdPIibXV2m0BAL8CwCODFW/4Nxi/EW0ED/IBPNj6GXLrFhly9bTlavXAH75bZk0cIP6QVz5tElqmPmPCPDFr4F5WDmMjlrgZH79+7R25w3kXA/P3JUICAZkaGkRBhNasTRxH2dA6Fmz8PiBe8xNztaaTPUYCh9S6WpTFOAgxLOsN9F8sFz8yCXSjS4oMpGT9kxPNEf57rZhj59PuyWLCHz352HYnGsKd8M5WARFqXUs2dPLD2j+3t7Yf/ZSqISJeGiphjn5TJcU8sxqsvHi+unub/2IytqD+bPnktSI4NMBTEzYsY46EJqYHDA81p3Bx5PjpsCRN/cTL5YZosqaQba8nPRqchEf7kKj2pygR4OiAforJHi4/c/gChqHzHDWNY4o/IQ1d1ztWJq+jmMRoNJOjlZo8UnixYh1H8vdrr5Yvc2dxTEhiMrLAjxX/vhJ20OBlrVCHFZi8xEgbnn3K1gZoAdVG2dcpg7aUy/mmZNwYY6HVbZfAq+rx881rtgjd2X2OnoCDeHNVhhbYd4b3ekBHkjzN0R1apMM5ChaTIDfESp8uLZwbt38PDhiGmR/Hn5V0iCg9GYIUFxVCiSfb9CQ3IcrucKodvPw42cOHRqRIjYvApNGtVrhUaacDATkKXy1Mm41fcHGZucwM3bN8iDvjtQHxHgYkEempOFKOF/i99L8/Diah1+SQzD0w4tpv65hNY4HkZ6us1AsAwIYYlpUtq64tH+4fvQtfxIysozyeVLrahOk6BRmoTMAB/w1jtB5OOB5pQIFO3dgZ6SLEzf0WHsYi1ecEcx9vQVmXxuINNGFtMGZpKqaGw7lZKVAn5MIJ2tFJEiXRMUGelQR/kjYL0DfNetRuhGJ8i8nZC2fS2a4nbhWYsULeevQt02gnz9X0TTNszUXRnHic6/u6h0pTJA+H0sjiTtozNkkcgvkpAsWQoOeLkgws0Zx+NicUutwGhjIWoFgehIcEe3OgEyXS+kun6SVd8P2eleY45+BKm63nRqjz81R5jCHxKn8iFKdGUKcnlQVtaTQFdXuH5uA8leH1TvD8JgcTzaE3dD6+8AbV4BFPpRknN6AMqmu6yiaQjy+sGpYw2D1uaXIlXIeRJZHCTiXbRcJSQbnHfgaHQwcbS1hof9Cgjc10HlvxHHeRtwOScE5Zoikn9uCMpzI0Rx5p5BfWEc8obBVDNMeyJjlsmKhJ6FlZVihPNjaXsbG6ZTo0C0jxexW7yYOC39iOxxsCV6EY9cKROTYoUMP9RWsVmFVYaqtj7knRlof/OO09J8rSx+qlRcun1HIPy3uuBs7lHj+cJjTHZMOBHzPEm7/ABaswRcK7Yy8owEY07qYSil8SjJy2xnjONzTftL639+zUqRfPMGusl5SwTP02OsVJyIsyopzuSmoSVbCL1cSAS7veHjtgUN2kKki2KnKgplqZZ9RTVN5kqp/LwQs83I5Fv91hppBh8ICVmoOBx7qFyS0KHLTHpUnRTDao7sJyHbXSe9tmzqOlWVm36iTGltgZVW1pj3nWy+QP0HeSTgCcW4TTwAAAAASUVORK5CYII=" alt="Leland Richardson" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition:opacity 0.5s;transition-delay:0.25s"/><noscript><picture><source srcSet="/static/6c2f2fd00cced646d2b72adfc80258b8/dc398/avatar-circle.png 1x" /><img width="156" height="156" src="/static/6c2f2fd00cced646d2b72adfc80258b8/dc398/avatar-circle.png" alt="Leland Richardson" style="position:absolute;top:0;left:0;transition:opacity 0.5s;transition-delay:0.5s;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></div></div><ul class="post-styles__LinkList-axwg2q-3 iDGdFF"><li><a rel="prev" href="/3-tricks-to-get-more-out-of-sql-server-in-common-web-scenarios/">← <!-- -->3 Tricks to get More out of SQL Server in Common Web Scenarios</a></li><li><a rel="next" href="/handling-paged-datasets-in-knockoutjs/">Handling Paged Datasets in Knockout.js<!-- --> →</a></li></ul></article></div><footer class="layout__Footer-sc-14pgzi3-0 fjerEM"></footer></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"lukemapper-a-super-fast-orm-for-lucenenet-a2a","path":"/lukemapper-a-super-fast-orm-for-lucenenet/"};window.dataPath="685/path---lukemapper-a-super-fast-orm-for-lucenenet-a-2-a-b47-D36HgGwnopXvlA3K2uZ6u5PGKE";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.1b56f0f3ea8e10aaf677.css","/app-873de7bb737df1e4d255.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-e3ca28e140b315b54f2e.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-1e472f78b066349f98a7.js"],"component---src-pages-404-js":["/component---src-pages-404-js-ec67f660d408a2a20253.js"],"component---src-pages-index-js":["/component---src-pages-index-js-ab24d5a620ef1e8918f5.js"],"pages-manifest":["/pages-manifest-553ac7f3ecaee0bf25be.js"]};/*]]>*/</script><script src="/webpack-runtime-3b803a0407233ac71e73.js" async=""></script><script src="/app-873de7bb737df1e4d255.js" async=""></script><script src="/1-633766256462afcfa2e5.js" async=""></script><script src="/component---src-templates-blog-post-js-1e472f78b066349f98a7.js" async=""></script><script src="/0-a21edeffd72a969fe347.js" async=""></script></body></html>