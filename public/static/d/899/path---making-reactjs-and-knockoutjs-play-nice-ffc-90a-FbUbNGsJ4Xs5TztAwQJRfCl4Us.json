{"data":{"site":{"siteMetadata":{"title":"Intelligible Babble","author":"Leland Richardson"}},"markdownRemark":{"id":"c5b79955-cded-56d8-8aba-a69fab742fca","excerpt":"Choosing a JavaScript framework or library to build a project with is a complicated choice, these days. There’s just so much to choose from…","html":"<p>Choosing a JavaScript framework or library to build a project with is a complicated choice, these days. There’s just so much to choose from. There’s the new hotness, then there’s the old and trusty.</p>\n<blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">I think I&#39;ve had milk last longer than some JavaScript frameworks.</p>&mdash; I Am Devloper (@iamdevloper) <a href=\"https://twitter.com/iamdevloper/status/540481335362875392?ref_src=twsrc%5Etfw\">December 4, 2014</a></blockquote>\n<script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\n<p>With such a rampant ecosystem of choice and change, there often comes a time where you want to refactor your project from using Framework/Library X to use Framework/Library Y.</p>\n<p>For now, I won’t make any points as to whether or not making these changes is good or bad or whatever, but instead I’d like to talk about how to make the transition between two particular frameworks easier: React.js and Knockout.js</p>\n<p>If you have a large project, making the transition all in one big pull request might not be a feasible option. It’s important to allow some sort of middle ground where the two code-bases or technologies can play nice with one another.</p>\n<h2>What do we want?</h2>\n<p>In order for a transition to be successful, you need two things: 1) You need to be able to use Knockout from within the context of React, and 2) You need to be able to use React from within the context of Knockout.</p>\n<p>Let’s think about what this might look like.</p>\n<h3>Using Knockout from within the context of React</h3>\n<p>React is built in terms of composable <code class=\"language-text\">Components</code>. Ideally, we could have some jump right into “knockout-land” from inside the <code class=\"language-text\">render</code> function of a React component. In “knockout-land”, it would be nice if we had access to the <code class=\"language-text\">this.props</code> and <code class=\"language-text\">this.state</code> of “react-land”.</p>\n<p>For example, we want something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> ToDoList <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>ul data<span class=\"token operator\">-</span>bind<span class=\"token operator\">=</span><span class=\"token string\">\"foreach: props.todos\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>li data<span class=\"token operator\">-</span>bind<span class=\"token operator\">=</span><span class=\"token string\">\"text: $data\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With JSX, this might not even be much more than copy-and-paste, and update a few variable names.</p>\n<p>There are a couple of complications right off the bat, though. React renders to a virtual representation of the DOM, then diff’s it from the previous version, then updates the actual DOM with what it found to be different. Knockout on the other hand, works with <em>actual</em> DOM. So we need to actually work with the DOM elements somewhere along the line. We can do this hooking into some lifecycle events.</p>\n<p>Naively, doing something like this get’s us a little bit closer to reality:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> ToDoList <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    ko<span class=\"token punctuation\">.</span><span class=\"token function\">applyBindings</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">{</span>\n        props<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">,</span>\n        state<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDOMNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>ul data<span class=\"token operator\">-</span>bind<span class=\"token operator\">=</span><span class=\"token string\">\"foreach: props.todos\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>li data<span class=\"token operator\">-</span>bind<span class=\"token operator\">=</span><span class=\"token string\">\"text: $data\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Still, we have a couple of issues. Namely, whenever the props or state update, knockout has no idea it needs to update. Additionally, whenever this component is unmounted, we aren’t cleaning up after ourselves very well.</p>\n<p>To tidy up after ourselves, we want to use the <code class=\"language-text\">ko.cleanNode</code> function and call it in the <code class=\"language-text\">componentWillUnmount</code> lifecycle method.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> ToDoList <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    ko<span class=\"token punctuation\">.</span><span class=\"token function\">applyBindings</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">{</span>\n        props<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">,</span>\n        state<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDOMNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">componentWillUnmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    ko<span class=\"token punctuation\">.</span><span class=\"token function\">cleanNode</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDOMNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>ul data<span class=\"token operator\">-</span>bind<span class=\"token operator\">=</span><span class=\"token string\">\"foreach: props.todos\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>li data<span class=\"token operator\">-</span>bind<span class=\"token operator\">=</span><span class=\"token string\">\"text: $data\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now for the trickier part. We could just call <code class=\"language-text\">ko.cleanNode</code> followed by <code class=\"language-text\">ko.applyBindings</code> on the <code class=\"language-text\">componentDidUpdate</code> method, but that seems pretty inefficient.</p>\n<p>Knockout actually allows the first parameter of <code class=\"language-text\">ko.applyBindings</code> to be an observable itself, and will update the DOM accordingly. As a result, it’s best to just create an observable whose value is set to an object with our props and state, and then we can just update the observable with our props and state change.</p>\n<p>We can do this in the <code class=\"language-text\">componentDidMount</code> method and then update in the <code class=\"language-text\">componentDidUpdate</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">    <span class=\"token function\">updateKnockout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">__koTrigger</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">__koTrigger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>__koTrigger <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">observable</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>__koModel <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">__koTrigger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// subscribe to changes of this...</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n                props<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">,</span>\n                state<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        ko<span class=\"token punctuation\">.</span><span class=\"token function\">applyBindings</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>__koModel<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDOMNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">componentDidUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateKnockout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>None of what we have done here is really component-specific, so we can easily abstract this out into a mixin:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> KnockoutMixin <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">updateKnockout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">__koTrigger</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">__koTrigger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>__koTrigger <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">observable</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>__koModel <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">__koTrigger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// subscribe to changes of this...</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        props<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">,</span>\n        state<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    ko<span class=\"token punctuation\">.</span><span class=\"token function\">applyBindings</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>__koModel<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDOMNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function\">componentWillUnmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    ko<span class=\"token punctuation\">.</span><span class=\"token function\">cleanNode</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDOMNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function\">componentDidUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateKnockout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We could then use this like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> ToDoList <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  mixins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>KnockoutMixin<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>ul data<span class=\"token operator\">-</span>bind<span class=\"token operator\">=</span><span class=\"token string\">\"foreach: props.todos\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>li data<span class=\"token operator\">-</span>bind<span class=\"token operator\">=</span><span class=\"token string\">\"text: $data\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Nice! Here’s a quick fiddle with a rapidly changing to do list whose state is being managed in React, but is being rendered by knockout:</p>\n<iframe width=\"100%\" height=\"300\" src=\"//jsfiddle.net/lelandrichardson/v2spwr3a/embedded/js,html,result/dark/\" allowfullscreen=\"allowfullscreen\" allowpaymentrequest frameborder=\"0\"></iframe>\n<p>Now that we have that direction covered, let’s see what we can do about the other way around.</p>\n<h3>Using React from within the context of Knockout</h3>\n<p>Similar to the first part of this post, let’s first try to figure out what kind of API we might want to create.</p>\n<p>React works in terms of “Components”, and Knockout has “binding handlers”, which are a little bit different but not entirely.</p>\n<p>Let’s say we have a <code class=\"language-text\">Contact</code> component in React-land, which accepts an <code class=\"language-text\">info</code> prop. It would be nice if we could render that component inside a div and have it look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>react: Contact, props: { info: info }<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>To do this, we are going to want to create a <code class=\"language-text\">react</code> binding handler.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">ko<span class=\"token punctuation\">.</span>bindingHandlers<span class=\"token punctuation\">.</span>react <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  init<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">,</span> valueAccessor<span class=\"token punctuation\">,</span> allBindings<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> Component <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token function\">valueAccessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> props <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">toJS</span><span class=\"token punctuation\">(</span>allBindings<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"props\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// render to react? initial setup maybe?</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> controlsDescendantBindings<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// important</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  update<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">,</span> valueAccessor<span class=\"token punctuation\">,</span> allBindings<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> Component <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token function\">valueAccessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> props <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">toJS</span><span class=\"token punctuation\">(</span>allBindings<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"props\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// tell react to re-render?</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Couple things of note here:</p>\n<p>First, we are returning <code class=\"language-text\">{ conrolsDescendantBindings: true }</code> from the <code class=\"language-text\">init</code> function of the binding handler. This tells knockout to not walk the DOM tree below this node, as this binding handler “has that covered”. This is really important because the DOM tree below us is going to be controlled by React, and we don’t want knockout to mess with it.</p>\n<p>Second, we are not creating a “props” binding, but we <em>are</em> retrieving the props passed into the <code class=\"language-text\">data-bind</code> attribute by using <code class=\"language-text\">allBindings.get(&#39;props&#39;)</code>.</p>\n<p>Third, we are using <code class=\"language-text\">ko.unwrap</code> and <code class=\"language-text\">ko.toJS</code> on our passed in Component and props because we want to make sure that what we pass into React-land are plain JS objects, and not knockout observables (under the assumption that we don’t want observables in React-land). Additionally, this “subscribes” this DOM element to the changes of any observable that is passed into, which will cause it to call the <code class=\"language-text\">update</code> function of this binding handler.</p>\n<p>We haven’t really done anything react-specific yet, but we’ve got most of the boilerplate out of the way.</p>\n<p>React has a <code class=\"language-text\">React.render</code> function which will mount a React tree onto a DOM element that we will want to use.</p>\n<p>Conveniently, React is pretty smart about how this render function works, and if we call it multiple times on the same mounted node, it will simply diff the two virtual DOM representations and update accordingly (making it a very cheap operation).</p>\n<p>Additionally, Knockout runs the <code class=\"language-text\">update</code> method right after <code class=\"language-text\">init</code> on first pass anyway, so it turns out our <code class=\"language-text\">init</code> method doesn’t really have to do anything. In the <code class=\"language-text\">update</code> method, in order to render to react we simply need to call:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">React<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>Component<span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And that’s it! With all that, we end up with a binding handler something like the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">ko<span class=\"token punctuation\">.</span>bindingHandlers<span class=\"token punctuation\">.</span>react <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  init<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> controlsDescendantBindings<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// important</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  update<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">,</span> valueAccessor<span class=\"token punctuation\">,</span> allBindings<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> Component <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token function\">valueAccessor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> props <span class=\"token operator\">=</span> ko<span class=\"token punctuation\">.</span><span class=\"token function\">toJS</span><span class=\"token punctuation\">(</span>allBindings<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"props\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// tell react to render/re-render</span>\n    React<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span>React<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>Component<span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> el<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Crazy simple, right? I don’t know if I should be more impressed with Knockout or React, but it sure was easy to get these two playing together nicely going this direction!</p>\n<p>Here is a fiddle that is doing basically the same thing as the fiddle above, but the todo items are being held in a <code class=\"language-text\">ko.observableArray</code> in knockout-land, but being rendered by React.js!</p>\n<iframe width=\"100%\" height=\"300\" src=\"//jsfiddle.net/lelandrichardson/vu9vq2u0/embedded/js,html,result/dark/\" allowfullscreen=\"allowfullscreen\" allowpaymentrequest frameborder=\"0\"></iframe>\n<p>Note: Using some of Knockout 3.0’s new features, it is probably possible to make this:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">data-bind</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>react: Contact, props: { info: model().info }<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>look a little more like this instead:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>Contact info<span class=\"token operator\">=</span><span class=\"token string\">\"model().info\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<p>However, I’m skeptical that this adds any value over what we have now. Would be a fun to get working though…</p>\n<h3>Some parting thoughts</h3>\n<p>I want to make it clear to people that I’m not trying to promote the usage of knockout and react together as a good practice. I think that if you are wanting to migrate a project from one to the other, this is a good way to do it “piece-meal”. That is all.</p>\n<p>Additionally, I haven’t given much thought to the performance of these implementations. I think if you are worried about the performance here it might be worth it for you to just spend the extra time to port the project into whatever library you want to end up in, however, if anyone wants to run some performance tests on the code above, or has any thoughts on how to make the implementation better, please let me know in the comments.</p>","fields":{"readingTime":{"text":"8 min read"}},"frontmatter":{"title":"Making React.js and Knockout.js Play Nice","date":"May 18, 2015"}}},"pageContext":{"slug":"/making-reactjs-and-knockoutjs-play-nice/","previous":{"fields":{"slug":"/custom-lucene-tokenizer-for-tech-keywords/"},"frontmatter":{"title":"Custom Lucene Tokenizer for Tech Keywords"}},"next":{"fields":{"slug":"/one-concern-one-file/"},"frontmatter":{"title":"One Concern, One File"}}}}